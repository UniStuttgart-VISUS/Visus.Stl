// <copyright file="LoessSmootherCompatTest.cs" company="Universität Stuttgart">
// Copyright © 2020 Visualisierungsinstitut der Universität Stuttgart. All rights reserved.
// </copyright>
// <author>Christoph Müller</author>

using Microsoft.VisualStudio.TestTools.UnitTesting;
using System;
using Visus.Stl.Maths;

namespace Visus.Stl.Test {


    /// <summary>
    /// Performs compatibility tests with the Java implementation at
    /// https://github.com/ServiceNow/stl-decomp-4j/blob/master/stl-decomp-4j/src/test/java/com/github/servicenow/ds/stats/stl/LoessSmootherTest.java
    /// </summary>
    [TestClass]
    public sealed class LoessSmootherCompatTest {

        [TestMethod]
        public void SmoothingWithLargeWidthGivesLinearRegressionFit() {
            // 100 point sample generated in Python with
            //
            // x = np.arange(0, 100)
            // y = 10.0 * x + 100.0*np.random.randn(100)
            double[] scatter100 = { 45.0641826945, 69.6998783993, 9.81903951235, -75.4079441854, 53.7430205615,
                12.1359388898, 84.972441255, 194.467452805, 182.276035711, 128.161856616, 147.021732433,
                -40.6773185264, 41.1575417261, 111.04115761, 75.0179056538, 278.946359666, 93.3453251262,
                103.779785975, 252.750915429, 252.636103208, 457.859165335, 143.021758047, 79.343240193, 280.969547174,
                35.650257308, 157.656673765, 29.6984404613, 141.980264706, 263.465758806, 346.309482972, 330.044915761,
                135.019120067, 211.801092316, 198.186646037, 206.088498967, 510.89412974, 332.076915483, 530.524264511,
                298.21175481, 234.317252809, 573.836352739, 382.708235416, 340.090947574, 452.475239395, 576.134135134,
                536.703405146, 545.033194307, 479.525083559, 368.551750848, 588.429801268, 528.672000843,
                507.301073925, 432.749370682, 600.239380863, 567.328853536, 481.544306962, 510.42118889, 456.519971302,
                565.839651322, 510.505759788, 503.2514057, 491.279917041, 642.319449309, 573.019058995, 574.709858012,
                597.316826688, 602.361341448, 622.312708681, 506.669245531, 640.120714982, 699.793133288,
                672.969830555, 656.645808774, 901.375994679, 573.903581507, 906.472771298, 719.604429516,
                759.262994619, 786.970584025, 717.422383977, 899.007418786, 745.516032607, 748.049043698, 876.99080793,
                810.985707949, 888.762045358, 947.030030816, 1007.48402395, 830.251382179, 921.078927761,
                810.212273661, 926.740829016, 787.965498372, 944.230542154, 808.215987256, 1044.74526488,
                866.568085766, 1068.6479395, 776.566771785, 1190.32090194 };

            // Fit to this data from Python with
            // from scipy.stats import linregress
            // slope, intercept, r, p, stderr = linregress(x, y)

            double testSlope = 9.9564197212156671;
            double testIntercept = -12.894457726954045;

            // Choose a loess width sufficiently large that tri-cube weights for all of the data will be 1.0.
            var builder = new LoessSmootherBuilder()
                .SetWidth(1000000);

            for (int j = 1; j < scatter100.Length - 1; ++j) {
                var loess = builder.SetJump(j).Build(scatter100);
                var smoothedPoints = loess.Smooth();

                for (int i = 0; i < smoothedPoints.Length; ++i) {
                    double y = testSlope * i + testIntercept;
                    Assert.AreEqual(smoothedPoints[i], y, 1.0e-8);
                }
            }
        }

        /// <summary>
        /// Test that our results agree with Python to something close to single
        /// precision epsilon.
        /// </summary>
        [TestMethod]
        public void SmoothedNoisySinusoid() {
            int width = noisySinusoid.Length / 3;
            var loess = new LoessSmootherBuilder()
                .SetWidth(width)
                .Build(noisySinusoid);
            var y = loess.Smooth();

            for (int i = 0; i < y.Length; ++i)
                Assert.AreEqual(smoothedNoisySinusoid[i], y[i], 1.0e-8);
        }

        /// <summary>
        /// Same test as above for quadratic interpolation.
        /// </summary>
        [TestMethod]
        public void SmoothedNoisySinusoidQuadratic() {
            int width = noisySinusoid.Length / 3;
            var loess = new LoessSmootherBuilder()
                .SetWidth(width)
                .SetDegree(2)
                .Build(noisySinusoid);
            var y = loess.Smooth();

            for (int i = 0; i < y.Length; ++i)
                Assert.AreEqual(smoothedNoisySinusoidQuadratic[i], y[i], 1.0e-8);
        }

        /// <summary>
        /// Test that skipping a point works and is in the ball park.
        /// </summary>
        [TestMethod]
        public void SmoothedNoisySinusoidWithShortJump() {
            int width = noisySinusoid.Length  / 3;
            var loess = new LoessSmootherBuilder()
                .SetWidth(width)
                .SetJump(2)
                .Build(noisySinusoid);
            var y = loess.Smooth();

            for (int i = 0; i < y.Length; ++i)
                Assert.AreEqual(smoothedNoisySinusoid[i], y[i], 5.0e-3);
        }

        [TestMethod]
        public void SmoothingSinglePointReturnsThatPoint() {
            double[] data = { Math.PI };
            var loess = new LoessSmootherBuilder()
                .SetWidth(3)
                .Build(data);

            var smoothed = loess.Smooth();
            Assert.AreEqual(1, smoothed.Length);
            Assert.AreEqual(Math.PI, smoothed[0]);
        }

        [TestMethod]
        public void DegreeMustBePositive() {
            Assert.ThrowsException<ArgumentException>(() => {
                new LoessSmootherBuilder().SetDegree(-1);
            });
        }

        [TestMethod]
        public void DegreeMustBeLessThanThree() {
            Assert.ThrowsException<ArgumentException>(() => {
                new LoessSmootherBuilder().SetDegree(3);
            });
        }

        [TestMethod]
        public void WidthMustBeSet() {
            Assert.ThrowsException<InvalidOperationException>(() => {
                new LoessSmootherBuilder().Build(new double[1000]);
            });
        }

        [TestMethod]
        public void DataMustBeSet() {
            Assert.ThrowsException<ArgumentNullException>(() => {
                new LoessSmootherBuilder().SetWidth(17).Build(null);
            });
        }

        #region Test data
        /// <summary>
        /// Noisy periodic data.
        /// </summary>
        /// <remarks>
        /// Generated in Python with
        /// xr = np.arange(0, 2*np.pi, 0.01)
        /// yr = np.sin(xr) + np.random.normal(size=len(xr))
        /// </remarks>
        private readonly double[] noisySinusoid = {
            0.615658846367, 0.081436552904, 0.230303730527, 0.959995931373,
            1.54375678078, 1.87862243581, -1.44775062759, 0.410557020262, -0.400078195349, -1.74843720234,
            -1.7693467618, -1.24065458102, -0.225061846055, -0.0590105622047, 0.729386767124, -0.774436105443,
            -0.847411516494, 0.146609588368, 0.0522003450766, -1.16000113745, -0.195452879962, 0.373004911483,
            0.400314541235, -0.247301744538, -0.0767877725718, -0.834193222175, -1.08582396673, -0.82781524606,
            0.563822426143, -0.768181702341, -0.879000358784, 0.657646035347, 0.0148919580624, 1.92356112272,
            -0.00694145977217, -1.35428175401, 0.0836975791801, 1.99041108307, -0.211557309039, 1.39094427958,
            -0.0950193229598, 2.24430563303, -0.494746143048, 0.703854881243, 0.752918382598, 0.358544253536,
            1.02730757073, 2.75353223474, 1.463326024, 1.51038874871, 0.780520356526, -0.0330385098536, 0.13399648989,
            -1.08915362368, 2.46320760895, 1.80895441206, 0.572889256238, 0.647705803156, -1.65184566126,
            -0.481505281229, 0.432781720392, 0.55671406427, 0.459205389684, -0.975011042981, 0.697206352096,
            0.387924596508, 0.674761930749, -0.0664940522652, 0.559320052689, 1.1291316633, 1.45637789857,
            0.594879524736, 0.840459967254, -0.253844783669, 0.413728621692, 1.60306089587, 1.89479963707,
            0.818570582486, 0.0473448228395, -0.209076769673, 0.00442298471855, 1.60367103633, 1.43395473502,
            -0.708420318625, 0.36712580069, 0.694439544985, -0.612767657575, 0.401505518503, 0.170234336584,
            2.35010530735, -0.698816092469, 0.885239902549, 1.83480784959, -0.189068304242, -0.430630149764,
            0.187847507876, 1.72781888177, 2.27263309993, 0.872516610641, 0.156227893278, -1.25952498462,
            -0.197655725877, 0.929537612408, 2.73213922163, 1.80014282669, -0.287863505968, 2.02771362056,
            2.98467796585, 0.774704260558, 1.44711204186, -0.0653144623658, -1.50064298555, 2.69267486598,
            0.778742780066, 0.820905738583, 0.895113173524, 0.872012430357, 1.56415365104, 2.53716509256, 1.7729293205,
            -0.0617068475224, -1.56252020679, 1.00382874605, 2.03854357846, 1.25040429611, 2.2528773498, 2.29357383494,
            2.26027843607, 1.9333560989, 1.86249435754, 1.25896476149, -0.712650053171, 1.22056489043, 1.87727990493,
            2.04848579398, 2.10249570612, 2.0251376431, 0.654915360955, 0.244160807296, -0.25343250919,
            -0.0715324942398, 1.91366718195, 1.88337922694, 0.355375034514, 0.946904406766, 1.91046413115,
            3.41926644255, 0.335121000396, 2.03131159076, 1.74813478524, 0.328471530918, 1.51627652046, 1.11061437716,
            -0.485011752603, -0.365234013717, 2.10762595213, -1.3316826101, 1.66904042795, 0.594366422318,
            2.86200324485, 0.815808894243, 2.75397625009, 0.645081142672, 1.02439061157, 2.36532541092, 0.826122899108,
            0.493356547796, -0.0342341724315, 1.22122605501, 0.756568006842, 2.19478046158, 1.50743606279,
            -0.296929268006, 2.06296703593, 1.45338292205, 0.759837186119, -0.958416219719, 0.592963067379,
            0.827449461781, 0.770296341846, 3.01630701136, 1.32062843781, 0.115877101195, 0.423230914356,
            1.33532556887, -1.03640650059, 2.85301103161, 2.21134526281, -0.23070606256, -0.643949827739,
            0.939714788285, 0.0835408296047, 2.2060858998, 0.274418081167, 2.49179006719, 2.70594300551, 1.23258909075,
            0.73174198164, 2.02520734392, 1.61990497298, 1.39420536826, 1.67941316178, 1.00194966324, 2.16582886948,
            0.33979337171, -0.0490559717682, 1.8705082687, 1.13978958147, 0.602136699874, 0.778530250973,
            0.188173483665, 0.966616102503, 0.161715510685, 1.00120227991, 0.208276889205, 2.78833449718,
            0.605202210521, 1.73306770758, 2.87305937797, -0.395452481902, 0.706867089551, -0.411455795575,
            -0.0130722105256, 2.33050037257, 1.33152123994, 1.93327188719, 0.788883804204, 0.952038928073,
            1.01289864674, 0.669533936485, 0.7356402193, 1.07023135516, -1.53858905277, 1.4691127672, 0.767968704332,
            -1.2479819541, -0.157417897114, 2.08431096253, 0.24226974918, 1.16580831641, 0.714772687735, 1.35643281115,
            3.03756234286, 4.01048428103, 0.0851386461644, 1.18562730303, 1.72652257093, 1.52492506631, 0.065908874681,
            1.18040750085, 2.02798402394, 1.12650943284, 0.99369876663, -0.114300833689, 2.35874782826, 1.46757458418,
            0.912054407788, 0.0472662300115, 0.0984657887447, 0.117117100074, 1.03238107299, 1.98703592288,
            1.75816571701, -1.17829331127, 0.552076435843, 1.4857203707, 0.652846436716, 0.317300127461, 1.45214694327,
            1.49973636801, 0.974798831127, 0.683225328856, 0.291951268325, 0.971381944065, 1.21378109034,
            -0.688040914506, -0.232685835141, -0.406237437844, -1.61656540565, -0.0165155876278, 2.20170708142,
            0.61189383893, -1.68864271351, 0.384175142052, -0.510627943997, -1.43707055614, 0.721853252991,
            0.359793855603, -0.042782451139, -0.175781536765, -1.01229207811, -0.174430482022, -0.46922927577,
            0.243335642437, -1.50577581445, 1.50195787299, 1.44752469547, 0.56533039066, -0.336654717899,
            0.137393515362, 0.362123718539, -0.775800535911, 0.384760491274, 2.25733369572, -1.08649380347,
            -0.840328133182, -0.532671955763, -1.13813939532, 0.372214987711, 0.238131305269, 0.0054035637112,
            -1.52545032184, -0.326714816855, 0.8855482641, -0.340535291045, -1.15595137386, 0.603371041527,
            -1.05054840339, 0.833571245507, 0.5200389805, -0.278843800887, -0.0407167042902, 0.514265241509,
            1.55968893136, -0.642048022637, 0.232224168922, 0.924271049336, -1.49964272963, -0.519415711109,
            -0.0747536527362, -0.389925024304, -0.367442800645, 0.350176778931, 0.674040637932, 0.397270659438,
            0.38615211148, -0.66040557792, -0.371372322553, -1.27131523072, -1.33088482102, -0.731652872084,
            -0.755712892152, 1.4093257612, -0.0513044070434, -0.893886218268, -0.764179025521, 0.582663181915,
            0.231814047934, -0.423390134527, 0.525494470455, -1.99536993173, 1.00521232761, -1.26026085605,
            -1.89211442785, 0.221226351913, -0.460488318039, -0.77768242949, -0.328404966147, 1.1152460103,
            0.1773573031, -1.68728039394, -2.15653910705, 0.117501321512, -0.71198668582, 1.20655551069,
            0.310359452912, 0.756636069807, -0.404167210507, 0.0737487587024, -2.20524359182, 0.529228686271,
            -0.192236773951, -1.57920962026, -0.41922929178, -1.56963433731, -1.66879814382, -1.11030115506,
            -0.439144654407, -0.287937130786, -0.660520500109, -1.47563215327, -1.38832809372, -0.419372845157,
            -0.590096265501, -2.50164181513, -0.843943298498, -0.868936410626, -2.67724267422, 0.339615482599,
            -0.586503860277, -0.30654581128, -0.665479008549, 0.283638302343, -1.1698244313, -1.73219091919,
            -0.509058635032, -1.95524974944, -1.44658424891, -1.4831513499, -1.06940568763, -0.383818481918,
            -2.53176608078, 0.239470878321, -1.58511302553, 0.643552269425, -1.68917628343, 0.517298879089,
            -1.52452032094, -0.470309650072, 0.498306366356, 0.453667489378, -1.09091302582, 2.03647586473,
            -1.02415906289, 0.297088337513, -0.555722509102, 1.04070863759, -2.05641119511, -1.21761876043,
            -1.98491999218, -2.67138156922, -1.69562207688, -2.50915001476, -1.08406421444, -2.67102038931,
            -2.43889970138, -0.69321569028, -0.331628037414, -2.98032559004, -1.13246038467, -0.969047777301,
            0.0523994637363, -1.42785634878, 0.807066125621, -2.04377138449, 0.297704070169, 0.0273852494273,
            0.275348007021, -1.63723247092, -0.970769210484, -1.48975059771, -0.0550463357104, -1.04331552641,
            -1.00243083235, 1.17822661469, -1.05571442789, -1.19041013204, -1.67811780915, -3.36127641731,
            -1.05040813771, -1.70850784997, -1.16116531909, -0.312792652786, -1.22005913692, -1.89684908765,
            -1.97580352941, -1.0235816059, -1.39142063465, -0.926071626312, -1.50041021265, 0.306694407123,
            -2.97441087721, -2.33029951554, -0.193333903839, 0.315570668578, -2.24784220262, -1.00765363482,
            0.030007513647, -1.5653379933, 0.436404721292, -2.41426228334, -1.48856119285, -0.262083724736,
            -0.709930058034, -1.98338170705, -2.14606256483, -0.295714212461, -0.563075047013, -1.41703253323,
            -2.55176475635, -0.912681003446, -2.87589467741, -1.93226263058, -1.23038760524, 0.110294895719,
            -0.759689354295, 0.652328702883, -1.81093950643, -1.58705668806, 0.594199227806, -2.67134704517,
            -1.69653760212, -2.48608577499, -0.298168110873, -3.29009492142, -0.878682611542, -3.63357771843,
            -0.87900406388, -3.48866174958, 0.811220958901, -1.16533267004, -1.13514248383, 1.5861240578,
            -1.50398400001, -0.460328249819, 0.138567025373, -1.35515386652, 0.521061796851, -1.42477379563,
            -0.276286740451, -0.347574152862, -0.757045845093, -0.956879713187, 0.103137463295, 1.1873784562,
            -1.40271143608, -0.451880916655, -1.07562868843, -1.53105092169, -0.919941860134, -2.22088268903,
            -1.64615030271, -1.77975298036, -1.82763149932, -2.5003995506, 0.853182706192, -2.63269559945,
            -1.06690007664, 0.902122738428, -2.67778277521, 0.0555636594888, 1.13078794034, -1.19354069539,
            -0.153968466319, -1.01584449411, 0.0172575109043, -1.30159123398, 0.102968679458, 0.409869781621,
            -2.36371007275, -0.644339682696, -1.58943336702, -2.42590331858, -1.25097104649, -2.8090510305,
            -0.826994875684, -0.314582468919, -0.491964159844, -0.107679513425, -2.54896379138, 0.614815971591,
            0.329868124551, -0.0498567859136, -0.769299336963, 0.0553058038494, -1.18641048088, 0.184379209247,
            -0.902231558695, -1.59230979053, -0.765050331038, -0.388131567915, -1.32148999873, 0.41179786215,
            0.0882600709956, 0.406248242421, -0.339165086677, 2.57306154694, 0.850343905489, 0.492771676298,
            0.299701272942, 0.683456484761, -1.03774403463, 0.594821838393, 0.392402018429, -1.89936105413,
            -0.88129183423, -0.693991046671, -1.432632887, 0.255449515667, 1.16792871549, -1.04168225414,
            -0.0687148229006, 0.301864669978, 1.51880329179, 0.003666211519, -0.0227345573172, -2.2191088818,
            -0.00585821069345, -0.243068053251, 0.0630002272131, 0.216464408265, -0.543076230194, -0.509979475341,
            -0.542841684277, -2.27955706472, -0.75932744756, 0.175076395336, -0.763512874775, -0.801407890022,
            -0.830818725619, -1.0111592519, -0.78516869679, 0.0886919393157, 0.113302422623, 0.597080746552,
            -0.312321877477, 1.7370559256, -0.776345443059, 0.0896138166447, -0.844495887447, -1.12945820714,
            -1.36357441773, -1.01700360393, 1.77766557867, -1.33200917016, -0.525718769859, -0.363861417573,
            -2.35413614586, 1.16841666695, 1.73708639614, 1.56753586875, 0.0919881810353, 0.314562300651,
            -0.962021714226, -0.707237404345, -0.483476616575, -1.38451677995, 0.937329482485, 1.50071896955
        };

        /// <summary>
        /// Reference LOESS data computed for the above noisy signal using Python's statsmodels' lowess function.
        /// </summary>
        /// <remarks>
        /// import statsmodels.api as sm
        /// lowess = sm.nonparametric.lowess
        /// wr = lowess(yr, xr, frac=1./3., is_sorted=True, it=0)
        /// </remarks>
        private readonly double[] smoothedNoisySinusoid = { -0.115429049556, -0.105616162671, -0.0958103965772,
            -0.0860120073923, -0.0762213010924, -0.0664386979789, -0.0566647922731, -0.0469003269604, -0.0371459975443,
            -0.0274025077379, -0.0176705218258, -0.00795055684518, 0.00175703450471, 0.0114520132461, 0.0211341761,
            0.0308033158139, 0.0404591921319, 0.0501016189488, 0.0597304790645, 0.0693456645273, 0.0789470868501,
            0.0885347412434, 0.0981086581614, 0.107668853616, 0.117215329421, 0.126748110843, 0.136267258853,
            0.145772918539, 0.155265343908, 0.164744868031, 0.174211838095, 0.183666676185, 0.193109885445,
            0.202541973566, 0.211963441294, 0.221374709958, 0.230776223608, 0.240168535452, 0.249552221708,
            0.25892778502, 0.268295728891, 0.277656520425, 0.287010618797, 0.296358403645, 0.305700277879,
            0.315036640393, 0.324367872763, 0.333694351892, 0.343016394944, 0.352334169367, 0.361647735,
            0.370957066144, 0.380262100507, 0.389562792626, 0.398859135136, 0.408151179003, 0.417438860348,
            0.426721998335, 0.436000369416, 0.44527375289, 0.454542049861, 0.463805243925, 0.473063333415,
            0.482316313403, 0.491564202441, 0.500807110506, 0.510045169812, 0.519278525996, 0.528507338619,
            0.537731817129, 0.546952187593, 0.556168639995, 0.565381307311, 0.574590310521, 0.583795775137,
            0.59299789538, 0.602196890405, 0.611392897248, 0.620585934278, 0.629775980048, 0.638963056182,
            0.648147262682, 0.657328735829, 0.666507502966, 0.675683483835, 0.684856639774, 0.69402690195,
            0.70319411566, 0.712358094175, 0.721518506795, 0.730674742058, 0.739825644337, 0.748969585779,
            0.758104163341, 0.767225846963, 0.776329887008, 0.785410034107, 0.794457996232, 0.803462679388,
            0.81240950771, 0.821280018216, 0.830051552997, 0.838697150258, 0.847185404623, 0.855480636547,
            0.861602474705, 0.867586302665, 0.873432203569, 0.879139898754, 0.884709819438, 0.890144050911,
            0.895446765831, 0.900622494878, 0.905678317838, 0.910621673212, 0.915459830427, 0.920199930487,
            0.92484724101, 0.929406109575, 0.933879816562, 0.938271522062, 0.942585114428, 0.946825068592,
            0.950997360773, 0.955108114606, 0.959162403018, 0.963164867899, 0.967119995926, 0.971032195437,
            0.97490512207, 0.97874029078, 0.982538275504, 0.986298079189, 0.990016298005, 0.993688742824,
            0.997310960746, 1.0008770703, 1.00438100343, 1.00781664599, 1.01117986264, 1.01446872948, 1.01768230575,
            1.0208187762, 1.02387672296, 1.02685464633, 1.0297513408, 1.0325644712, 1.03529219984, 1.03793221991,
            1.04048188793, 1.0429377781, 1.04529520055, 1.04755079913, 1.04970342077, 1.05175294185, 1.05369964368,
            1.0555435249, 1.05728358541, 1.05891884852, 1.06044852385, 1.06187378818, 1.06319572469, 1.06441565909,
            1.06553532026, 1.06655486463, 1.06747316035, 1.0682893656, 1.06900350872, 1.06961578969, 1.07012530863,
            1.07053060465, 1.0708302958, 1.07102282137, 1.07110483755, 1.07107199811, 1.07091918035, 1.0706403444,
            1.0702298912, 1.06968446146, 1.06900061945, 1.06817362224, 1.06719966919, 1.06607557791, 1.0647978659,
            1.0633636821, 1.06177039994, 1.06001548505, 1.05809769975, 1.05601597757, 1.05376845322, 1.05135346522,
            1.0487700338, 1.04601618933, 1.04309136833, 1.0399967418, 1.03673546908, 1.03330988004, 1.02972242274,
            1.02597668017, 1.02207537649, 1.01802064335, 1.01381555847, 1.0094633348, 1.00496760184, 1.00033165907,
            0.995557164101, 0.990644245178, 0.985592210909, 0.980400073279, 0.975067212616, 0.969593802821,
            0.963980311433, 0.958228206528, 0.952340340035, 0.946320610805, 0.940173095619, 0.933901698066,
            0.927508836672, 0.920997554906, 0.914370860407, 0.907631872279, 0.900784667611, 0.893832915858,
            0.886781144343, 0.879635647417, 0.872401860484, 0.865082937009, 0.857678941025, 0.850188611069,
            0.842610675069, 0.834944274908, 0.827189988298, 0.819349920734, 0.811427478532, 0.80342675268,
            0.795351891967, 0.787205771121, 0.778988958014, 0.770701245583, 0.762342854551, 0.753916358256,
            0.745425802671, 0.736875611957, 0.728269544649, 0.719610558635, 0.710899929946, 0.702137703782,
            0.693324321478, 0.684459466952, 0.675542505749, 0.666571673696, 0.657544751218, 0.648461364407,
            0.639321203319, 0.630124583986, 0.620873074175, 0.611569168858, 0.602216002242, 0.592815445878,
            0.583366766902, 0.573868387262, 0.564319253579, 0.554717976527, 0.545063609183, 0.535355786551,
            0.525595632643, 0.515784533828, 0.505923665392, 0.496014619682, 0.486059244174, 0.476059422175,
            0.466016592607, 0.455930522685, 0.445799018964, 0.435619395571, 0.42538922666, 0.415107490446,
            0.404773915335, 0.394387206909, 0.383946703227, 0.373453251215, 0.362907542908, 0.352307262009,
            0.341649199474, 0.33093003631, 0.320145796369, 0.30929538638, 0.298379521374, 0.287399035234,
            0.276354861058, 0.265248708896, 0.254080968869, 0.242852880889, 0.231566987178, 0.220224189972,
            0.208823229412, 0.197361911311, 0.185837100679, 0.174245922285, 0.162584300505, 0.150850016894,
            0.139042634398, 0.127163234789, 0.115213074918, 0.103195063719, 0.091112472404, 0.0789699098905,
            0.0667743781315, 0.0545347131678, 0.0422614162096, 0.0299665661022, 0.0176616980034, 0.00535943799576,
            -0.00692668045781, -0.0191825728619, -0.031395922887, -0.0435562956493, -0.0556551737204, -0.0676868364077,
            -0.0796472741129, -0.091534448222, -0.103345993855, -0.115080806357, -0.126737944122, -0.138314578855,
            -0.149808181359, -0.161217921199, -0.172544389984, -0.183788567358, -0.194949258092, -0.206023897467,
            -0.217007711295, -0.227895819279, -0.238682148161, -0.249359415147, -0.259919852909, -0.270356535425,
            -0.280663492645, -0.290837067932, -0.300873465149, -0.310769526244, -0.32052415126, -0.330136548661,
            -0.339606260552, -0.348934960269, -0.358126706323, -0.367188605583, -0.376128589329, -0.384953747528,
            -0.393669156719, -0.402279798521, -0.410791127797, -0.419208803091, -0.427539166982, -0.435789215014,
            -0.443965734023, -0.452074624701, -0.460121340586, -0.468110675578, -0.476049431469, -0.483944566738,
            -0.49180124651, -0.499622987376, -0.507414117949, -0.515179589292, -0.522924188355, -0.530652597347,
            -0.53836767398, -0.546072542988, -0.553771973442, -0.561470365144, -0.569170934151, -0.576877625864,
            -0.58459512719, -0.592326312505, -0.600072114714, -0.607832663553, -0.61560820291, -0.623398616573,
            -0.631203934188, -0.639023642108, -0.646856870321, -0.654701389731, -0.662554245382, -0.670412421177,
            -0.678273099616, -0.686131317856, -0.693980221725, -0.701814814699, -0.709630732308, -0.717425046966,
            -0.725195829959, -0.732942128579, -0.740662958144, -0.748358834329, -0.756030664072, -0.763680828562,
            -0.771310467922, -0.778920151224, -0.786509670748, -0.794077462859, -0.801620568147, -0.80913384844,
            -0.816610262115, -0.824042732314, -0.831423087034, -0.838743220723, -0.84599504718, -0.853169623845,
            -0.860256144376, -0.867244279018, -0.874123944027, -0.880884804013, -0.88751810399, -0.894015876155,
            -0.900370796033, -0.906577040263, -0.91263117874, -0.918532197069, -0.924279757137, -0.929874933453,
            -0.935320793566, -0.940621160476, -0.945779516355, -0.950799676327, -0.955684868013, -0.960437088848,
            -0.965058962749, -0.96955164015, -0.973913424906, -0.978142243154, -0.982235291632, -0.986189170025,
            -0.990001260579, -0.993669904686, -0.997193256975, -1.00056928942, -1.00379776784, -1.00687892298,
            -1.00981346733, -1.01260280969, -1.01524864333, -1.01775415661, -1.0201229202, -1.02235879113,
            -1.02446624504, -1.02645059657, -1.02831841904, -1.0300739234, -1.03171941008, -1.03325662721,
            -1.03468746694, -1.03601269486, -1.03723267453, -1.03834724984, -1.03935617015, -1.04026070663,
            -1.04106155583, -1.04176002164, -1.04235898396, -1.0428604759, -1.04326580268, -1.0435760795,
            -1.04379122261, -1.04390722664, -1.04391840698, -1.04382005804, -1.04360876398, -1.04328121977,
            -1.04283516274, -1.04226699967, -1.04157237076, -1.04074723192, -1.03978799791, -1.03869169462,
            -1.03745717158, -1.03608183135, -1.03456128772, -1.0328920916, -1.03107086526, -1.02909411511,
            -1.02695773604, -1.0246577449, -1.02219011589, -1.01955182275, -1.01674002783, -1.01375270983,
            -1.01058837021, -1.00724537653, -1.00372244037, -1.00002002734, -0.99614007455, -0.992086550643,
            -0.987865197932, -0.983480846575, -0.978938205079, -0.974241675927, -0.969395517227, -0.964403130393,
            -0.959267956927, -0.95399314475, -0.948581347649, -0.943035314959, -0.93735822709, -0.931553159356,
            -0.925623825146, -0.919574451469, -0.9134115801, -0.907142919085, -0.900778031343, -0.894326263939,
            -0.887796217851, -0.881196686339, -0.874537402965, -0.867828503453, -0.861080414273, -0.854301425348,
            -0.847496946716, -0.840668335283, -0.833815457428, -0.826936629988, -0.820029491788, -0.813090060529,
            -0.806114527107, -0.799099502176, -0.791231879695, -0.783459304546, -0.775761543997, -0.76812086603,
            -0.760522205173, -0.752953196323, -0.745403553443, -0.737865079494, -0.730331492724, -0.722797877544,
            -0.715260458998, -0.707716339429, -0.700163371757, -0.69259992565, -0.685024892631, -0.6774375721,
            -0.669837360382, -0.662223789672, -0.654596423181, -0.646954766195, -0.639298313854, -0.631626478753,
            -0.623938739655, -0.616234706964, -0.608514106341, -0.600776740568, -0.593022360448, -0.585250853118,
            -0.57746225429, -0.569656685069, -0.561834298772, -0.553995298825, -0.54613988583, -0.538268308523,
            -0.530380798382, -0.522477522329, -0.514558634924, -0.506624300132, -0.498674664998, -0.490709945694,
            -0.482730431981, -0.47473648327, -0.466728526099, -0.458707180203, -0.450673181232, -0.442627324425,
            -0.434570449287, -0.426503430405, -0.418427107099, -0.41034234851, -0.402250030563, -0.394150920899,
            -0.386045711104, -0.377935033702, -0.369819449931, -0.361699546307, -0.353575974599, -0.345449354465,
            -0.337320302198, -0.329189479913, -0.321057643376, -0.312925572029, -0.304794015769, -0.296663605919,
            -0.288534946115, -0.280408633761, -0.272285275361, -0.264165487783, -0.256049857967, -0.247938933979,
            -0.239833199362, -0.231732997391, -0.223638608112, -0.215550309828, -0.207468337488, -0.199392866776,
            -0.191324009459, -0.183261806005, -0.175206249447, -0.167157340595, -0.159115108898, -0.151079627088,
            -0.143050993743, -0.135029404799, -0.127015042526, -0.119008075548, -0.111008608998, -0.103016648186,
            -0.0950320848143, -0.0870547604657, -0.0790846009865, -0.0711214717537, -0.0631651823879, -0.0552154769137,
            -0.0472719627301, -0.0393343234002, -0.0314024124287, -0.0234762248589, -0.0155557957234,
            -0.00764116700108, 0.000267694225521, 0.00817089676402, 0.0160686218156, 0.0239611423745
        };

        /// <summary>
        /// Reference LOESS data from R
        /// </summary>
        /// <remarks>
        /// > df <- # data frame with input data from above
        /// > loess_fit_2 <- loess(df$data ~ df$x, span=1.0/3.0, degree=2, iterations=1, family="symmetric", surface="direct")
        /// </remarks>
        private readonly double[] smoothedNoisySinusoidQuadratic = { -0.229846507835381, -0.215965189399665,
            -0.202125640935767, -0.188328400632176, -0.174574104168342, -0.160863590740425, -0.147197987322796,
            -0.133578638287119, -0.120006755712345, -0.106483512670333, -0.093009967405829, -0.0795869035127199,
            -0.066214821874617, -0.0528940319693551, -0.039624772866716, -0.0264072698495869, -0.0132417714780268,
            -0.000128433505787534, 0.0129326959822771, 0.0259415983286561, 0.038898296052621, 0.0518029271835999,
            0.0646556847291954, 0.0774567591026639, 0.0902063397748514, 0.10290465738324, 0.115551996049446,
            0.128148742826414, 0.140695410304149, 0.153192602419065, 0.165640946025619, 0.17804115173113,
            0.190394018607237, 0.202700356119106, 0.214960972053374, 0.227176599423243, 0.239347998166215,
            0.251476041671964, 0.263561629617875, 0.275605588468478, 0.287608745263389, 0.299571887207741,
            0.311495788837128, 0.323381133286506, 0.335228619233253, 0.347038929405845, 0.358812713355026,
            0.370550598494251, 0.382253122470776, 0.393920620034507, 0.405553262711156, 0.417151076974591,
            0.428713998723516, 0.440241937713468, 0.451734804786807, 0.463192538512419, 0.474614868483969,
            0.48600130228547, 0.497351220563572, 0.50866393833933, 0.519938878949159, 0.531175518780597,
            0.54237328426968, 0.553531519536864, 0.564649523129368, 0.575726651991533, 0.586762204938698,
            0.59775540024895, 0.608705366920846, 0.61961119511264, 0.630471867474172, 0.641286153233261,
            0.652052554444238, 0.662769367340784, 0.673434693219592, 0.68404653406062, 0.694602690404918,
            0.705100539622948, 0.715536940019479, 0.725908346145734, 0.736210929836843, 0.746440609473883,
            0.756592930230814, 0.766662747770155, 0.776644185400598, 0.786530865698846, 0.796315723240437,
            0.805990848995404, 0.815547543576906, 0.824976066333937, 0.834265356465477, 0.843402550568588,
            0.852373180426663, 0.861160750615828, 0.869746361763542, 0.878109024838363, 0.886225945392479,
            0.894072814578327, 0.901624446970358, 0.908856660966304, 0.915750214756102, 0.922297010045138,
            0.92850929012314, 0.9344317841379, 0.940157477140629, 0.946896217674188, 0.953487266322782,
            0.959961935019139, 0.966353584280381, 0.972691660989674, 0.978998728357581, 0.985287661562317,
            0.991569583928337, 0.997845947872448, 1.00411368310532, 1.01036834833343, 1.01660536780339,
            1.02282733329225, 1.02903966419016, 1.03524957951805, 1.04146043006712, 1.04766923270854, 1.05387028955491,
            1.06005318811178, 1.06620556222573, 1.07231629218549, 1.07837340944239, 1.08436186543368, 1.09026243857183,
            1.09605421000821, 1.10171984558106, 1.107240894964, 1.11260202281837, 1.11779614707474, 1.122816048568,
            1.12765160451187, 1.13229508035968, 1.13673668615568, 1.14096487683212, 1.14496003894202, 1.14869520327398,
            1.15214342064479, 1.15528576842718, 1.15810399206802, 1.16058242856467, 1.16270823008437, 1.16447646006826,
            1.16588173711277, 1.1669212553996, 1.16759711794697, 1.16791725588076, 1.16789741394188, 1.16755212430217,
            1.16689029804137, 1.16591964780419, 1.16464995255819, 1.16309449735584, 1.16127071867412, 1.15919828222187,
            1.15689720407834, 1.15438075132904, 1.15166089722792, 1.1487468627806, 1.14564331346513, 1.14236018559583,
            1.13891185094419, 1.13531004164849, 1.13156315356112, 1.12768006004113, 1.12367578349513, 1.11956847363048,
            1.11537662588104, 1.11111907610773, 1.10682210966482, 1.10251746006926, 1.09823909177928, 1.09402302290983,
            1.08990261776799, 1.08590339459893, 1.08205174066491, 1.07837913322304, 1.07491207149267, 1.0716708270633,
            1.0686737165774, 1.06593487830837, 1.06346623777523, 1.06127808346256, 1.05937535560672, 1.05775820938754,
            1.05642599631766, 1.05537634272126, 1.05460402721527, 1.05410650353559, 1.05387490942045, 1.05389233545367,
            1.05413400835691, 1.05457666549589, 1.05519454993147, 1.05595675324668, 1.0568355401993, 1.0578046340525,
            1.05883428260131, 1.05989490842407, 1.06095485389661, 1.06198284429284, 1.06295237578244, 1.06384354975726,
            1.0646417505029, 1.06533444584153, 1.06590840993792, 1.06634793539281, 1.06663729798635, 1.06675859843685,
            1.0666888945353, 1.06640139620413, 1.0658683073284, 1.06506237242904, 1.06396141327534, 1.06254165887294,
            1.06077925537094, 1.05864937650311, 1.05612630696648, 1.05318922313402, 1.04981779466385, 1.04598755532205,
            1.04167733254609, 1.03687477874403, 1.03158033825475, 1.02580201817686, 1.01955029393263, 1.01283648243841,
            1.00566920027514, 0.998053828559363, 0.989993404424037, 0.981492323651094, 0.972555869373329,
            0.963195320918625, 0.953433863398441, 0.943299395362077, 0.932817384257068, 0.922004262837389,
            0.910870501729179, 0.899424367604844, 0.887674598339091, 0.875629100497772, 0.863298874112805,
            0.85070049774142, 0.837849696997592, 0.824764680547054, 0.811464797680636, 0.797975358877026,
            0.784323357749841, 0.770526524484917, 0.756600891718879, 0.742559013274485, 0.728407576544825,
            0.714146940125542, 0.699773074988805, 0.685285711380366, 0.670694263034896, 0.656011410511999,
            0.641247750265348, 0.62641487152829, 0.611522252024477, 0.596578030211063, 0.581588046858952,
            0.566559114821765, 0.551498947516825, 0.536413781745403, 0.521309455509049, 0.506190555974718,
            0.491061442336346, 0.475931505887818, 0.460816687940291, 0.445733834959842, 0.43069708507081,
            0.415713354007121, 0.40078643588858, 0.385924067413489, 0.371131425257312, 0.356408094990676,
            0.341752780761877, 0.327172544725347, 0.312676350785609, 0.298274527026466, 0.283979544235027,
            0.269792239588245, 0.255706680697695, 0.241715408601498, 0.227810055301722, 0.213979697647995,
            0.20022029909018, 0.186526606800418, 0.172889025087199, 0.159305084877778, 0.145781745813162,
            0.132331819455253, 0.118971833371091, 0.105717197247446, 0.0925892675473277, 0.0796043173712825,
            0.0667732680425408, 0.0541026678486969, 0.0416012056929781, 0.0292725544949907, 0.0171189824545016,
            0.00514009346311017, -0.00667075695608148, -0.0183242177251586, -0.0298343836451058, -0.0412196960483096,
            -0.0524941618168459, -0.0636733920423151, -0.0747729770477703, -0.0858083169990707, -0.0967869866472005,
            -0.107707831532438, -0.118560792661125, -0.129325411429641, -0.139975009438833, -0.150477554017885,
            -0.160805403880467, -0.17092891108324, -0.180821770706142, -0.190470861099011, -0.199868108732714,
            -0.209002998778227, -0.217864061737824, -0.226442517634566, -0.234739949113243, -0.242765643367543,
            -0.250540528724015, -0.258088645665678, -0.265441569519663, -0.272638915847468, -0.279725537339085,
            -0.286746060400934, -0.293744420366154, -0.300757192471775, -0.307822672337897, -0.314976754781641,
            -0.322246506047924, -0.329656326209245, -0.33722784716681, -0.344974601932842, -0.352899784137994,
            -0.360992748817072, -0.36923830363121, -0.377624996971938, -0.38615055058759, -0.39481380376022,
            -0.403612125970519, -0.412541100047014, -0.421594910009888, -0.430764583048593, -0.440040320523143,
            -0.449416042492079, -0.458887465384404, -0.468452188151605, -0.478099552175734, -0.487819918531604,
            -0.497611636457226, -0.507477651755283, -0.517414947324288, -0.527416981273636, -0.537476234214333,
            -0.547585030484932, -0.55774206088508, -0.567944438269973, -0.57818140786124, -0.58844133506113,
            -0.59871319566745, -0.608981286209245, -0.619225125189862, -0.629428443985999, -0.639580386228107,
            -0.649670493820202, -0.659685535238708, -0.669612629148853, -0.679438768864085, -0.689154842667389,
            -0.69875462035438, -0.708237296050087, -0.717604455784907, -0.726857410081803, -0.73599515990673,
            -0.745022929463852, -0.753952940019799, -0.762789442566704, -0.771532881641688, -0.78017957199868,
            -0.78872307222753, -0.79715432224249, -0.80546621056694, -0.813648498033856, -0.821691128595442,
            -0.829579189332257, -0.837303877891313, -0.844857837959931, -0.85223562251858, -0.859434994787886,
            -0.866456955831224, -0.873309615221127, -0.880005929553115, -0.886558100075256, -0.892981077220976,
            -0.899289247785904, -0.905495445028707, -0.911615535759597, -0.917671948439829, -0.92368584517601,
            -0.929679065859039, -0.935675279815512, -0.941691562096075, -0.947743844428033, -0.953846007769902,
            -0.96000746640807, -0.966229647103686, -0.97250666005643, -0.978830366273451, -0.985187874623729,
            -0.99155855056666, -0.997918508343329, -1.0042452181574, -1.01051431694004, -1.01670452176832,
            -1.02279847655661, -1.02877534822031, -1.03462120776222, -1.04033435803555, -1.04591319403746,
            -1.05135882771985, -1.0566757469982, -1.0618669378556, -1.06693210543076, -1.07187324979692,
            -1.07669246213545, -1.0813857376443, -1.08594913560782, -1.09037900246658, -1.09467036706815,
            -1.09881948801411, -1.10281964919632, -1.10666687685031, -1.11035908866936, -1.11389415997037,
            -1.11726985074135, -1.12048006023389, -1.12352842994428, -1.12642522428949, -1.12918003484319,
            -1.13180029097771, -1.13429625168799, -1.13667899143061, -1.13896174736957, -1.14115746263236,
            -1.14327157551016, -1.14531055815275, -1.14727811927625, -1.14917082194064, -1.1509875053952,
            -1.1527283754554, -1.15439316594122, -1.15598198509012, -1.15750617457189, -1.15898158366027,
            -1.16041803712037, -1.16181515703411, -1.16316753662421, -1.16446227323142, -1.16568815206128,
            -1.16683498459193, -1.16788832250208, -1.16883076987899, -1.16964365554305, -1.17030223795603,
            -1.17078756372033, -1.17108802058718, -1.17119041124351, -1.17108369166799, -1.17075843721962,
            -1.17020718620691, -1.1694219439453, -1.16839372625023, -1.16711002169579, -1.16556019758608,
            -1.16373444189459, -1.16162458355391, -1.15922728017955, -1.15654028239162, -1.15355695564705,
            -1.15026874455605, -1.14666086297847, -1.14271329986026, -1.13841116336267, -1.13374291646147,
            -1.12869945603059, -1.12327474664749, -1.11746759438773, -1.11127982323544, -1.10471630076289,
            -1.09778842877803, -1.0905101576577, -1.08289601809744, -1.07496427666299, -1.06673100558468,
            -1.05821085410833, -1.04940995607584, -1.04032949129016, -1.03096415587205, -1.02130929585436,
            -1.01136308978486, -1.00112241338643, -0.990579370968226, -0.979723071550649, -0.968541843880483,
            -0.957033939127465, -0.945207550844916, -0.933085268617589, -0.920693635946368, -0.908063317115646,
            -0.895226671437484, -0.882221800615727, -0.86908657489321, -0.855858160029337, -0.842297071773876,
            -0.829099926881974, -0.816313014035571, -0.803959693675166, -0.792041654436452, -0.780544129630988,
            -0.769440866416511, -0.758699622583022, -0.748286127749495, -0.738166126565454, -0.728306994639489,
            -0.718678512389552, -0.709253349068547, -0.700006983279634, -0.690917837361743, -0.681967049558232,
            -0.673137792515928, -0.664415205341138, -0.655786040077182, -0.647238335009523, -0.638761353484417,
            -0.630345308261493, -0.621981517012293, -0.613662416515458, -0.605381435006798, -0.597132834956966,
            -0.588911395154795, -0.580712695379461, -0.572533081059708, -0.564369494053271, -0.556219328385372,
            -0.54808042225472, -0.539950926179675, -0.53182936304051, -0.523714484184996, -0.515605163064988,
            -0.507500467130507, -0.499399678080003, -0.491302231180701, -0.483207844868693, -0.475116512027372,
            -0.467028477706662, -0.458944219126802, -0.450864626767171, -0.442790863514759, -0.434724261006734,
            -0.426666282146073, -0.41861849499317, -0.410582461096213, -0.40255981913686, -0.394552244351908,
            -0.386561287567764, -0.378588418136543, -0.370635046104915, -0.362702506273035, -0.354792176922489,
            -0.346905523048529, -0.339043974132033, -0.331208955567579, -0.323401941546292, -0.31562450303239,
            -0.307878223539463, -0.300164638018895, -0.292485137183913, -0.284841065645661, -0.277233743885019,
            -0.269664482801509, -0.262134583631538, -0.254645295987724, -0.247197808553501, -0.23979322332372,
            -0.232432479954829, -0.225116433137436, -0.217845914166627, -0.21062168907449, -0.203444442112114,
            -0.19631477014682, -0.189233173878216, -0.182200081237077, -0.175215904796492, -0.168281065165919,
            -0.161396008894468, -0.154561192236895, -0.147777164445189, -0.141044445485645, -0.134363526034229,
            -0.127734806254072, -0.121158546210458, -0.114634840521035, -0.108163692986781, -0.101745192988427,
            -0.0953793241497898, -0.089065966505242, -0.0828048758404412, -0.0765955709877513, -0.070437649814878,
            -0.0643309495157978, -0.0582755235121762, -0.0522714904018685, -0.0463189833314391, -0.0404180047233896,
            -0.034568414839913, -0.0287699271820207, -0.0230220609311622
        };
        #endregion

    }
}
